{% extends "mainapp/base.html" %}
{% load static %}
{% block title %}SD Card Reader{% endblock %}

{% block content %}
  {% if messages %}
    <ul class="mb-4">
      {% for msg in messages %}
        <li class="p-2 {{ msg.tags }}">{{ msg }}</li>
      {% endfor %}
    </ul>
  {% endif %}

  <div class="relative">
    <div id="loading-overlay" class="hidden absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50">
      <!-- spinnerâ€¦ -->
    </div>

    <div class="flex justify-center mt-20 bg-gray-100">
      <div class="bg-gray-100 border shadow-md rounded-md p-8 w-full max-w-md">
        <h2 class="text-xl font-bold mb-6">SD-card reader</h2>

        <form id="sd-form" method="post" action="{% url 'sd_card' %}">
          {% csrf_token %}

          <!-- Pilot -->
          <div class="mb-4">
            <label for="pilot" class="block mb-1 text-sm font-medium">Pilot:</label>
            <input type="text" id="pilot" name="pilot" required
                   class="w-full bg-gray-300 p-2 rounded">
          </div>

          <!-- Wind speeds -->
          <h2 class="p-2 text-black mb-4">Wind speed:</h2>
          <div class="flex space-x-6 mb-4">
            {% for i in "123"|make_list %}
              <div class="w-1/3">
                <label for="wind_speed{{ i }}" class="block mb-1 text-sm font-medium"> {{ i }}:</label>
                <input type="number" id="wind_speed{{ i }}" name="wind_speed{{ i }}" min="0" required
                       class="w-full bg-gray-300 p-2 rounded">
              </div>
            {% endfor %}
          </div>

          <!-- Comments -->
          <div class="mb-6">
            <label for="comments" class="block mb-1 text-sm font-medium">Comments:</label>
            <textarea id="comments" name="comments" rows="4"
                      class="w-full bg-gray-300 p-2 rounded resize-none"></textarea>
          </div>

          <!-- Drone model selector -->
          <div class="mb-6">
            <label for="drone_model" class="block mb-1 text-sm font-medium">Drone model:</label>
            <select id="drone_model" name="drone_model" required
                    class="w-full bg-gray-300 p-2 rounded">
              <option value="">â€” Select a drone â€”</option>
              {% for model in drone_models %}
                <option value="{{ model }}" {% if model == selected_drone %}selected{% endif %}>
                  {{ model }}
                </option>
              {% endfor %}
            </select>
          </div>

          <!-- SD Cards -->
          <h2 class="text-lg font-semibold mb-2">Choose SD card:</h2>
          {% if sd_cards %}
            <div class="space-y-2 mb-6">
              {% for card in sd_cards %}
                <label class="flex items-center space-x-2">
                  <input type="radio" name="sd_card" value="{{ card }}" required
                         class="form-radio h-4 w-4 text-indigo-600"/>
                  <span class="px-4 py-2 bg-indigo-300 rounded">{{ card }}</span>
                </label>
              {% endfor %}
            </div>
          {% else %}
            <p class="text-red-600 mb-6">
              ðŸš« No SD cards with a <code>DCIM</code> folder were found.
            </p>
          {% endif %}

          <div class="flex justify-center">
            <button id="upload-btn" type="submit"
                    class="px-6 py-2 rounded font-semibold bg-green-200 hover:bg-green-300">
              UPLOAD
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('sd-form').addEventListener('submit', function(){
      document.getElementById('loading-overlay').classList.remove('hidden');
      document.getElementById('upload-btn').disabled = true;
    });
  </script>
{% endblock %}
