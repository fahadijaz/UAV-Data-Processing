{% extends "mainapp/base.html" %}

{% block title %}SD Card Reader{% endblock %}

{% block content %}
<div class="relative">
  <!-- Loading overlay (hidden by default) -->
  <div id="loading-overlay"
       class="hidden absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50">
    <!-- Spinner -->
    <svg class="animate-spin h-12 w-12 text-green-500" xmlns="http://www.w3.org/2000/svg" fill="none"
         viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
      <path class="opacity-75" fill="currentColor"
            d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"/>
    </svg>
    <span class="ml-4 text-green-700 font-semibold">Transferringâ€¦</span>
  </div>

  <div class="flex justify-center mt-20 bg-gray-100">
    <div class="bg-gray-100 border border-black shadow-md rounded-md p-8 w-full max-w-md">
      <h2 class="text-xl font-bold mb-6">SD - card reader</h2>

      <form id="sd-form" method="post" action="{% url 'sd_card' %}">
        {% csrf_token %}

        <!-- Pilot & Date -->
        <div class="mb-4">
            <label for="pilot" class="block mb-1 text-sm font-medium text-black-700">Pilot:</label>
            <input type="text" id="pilot" name="pilot" required
                   class="w-full bg-gray-300 text-black p-2 rounded">
        </div>

        <!-- Wind speed -->
        <h2 class="p-2 text-black mb-4">Wind speed:</h2>
        <div class="flex space-x-6 mb-4">
          <!-- Wind speed 1 -->
          <div class="w-1/3">
            <label for="wind_speed1" class="block mb-1 text-sm font-medium text-gray-700">1:</label>
            <input type="number" id="wind_speed1" name="wind_speed1" min="0" required
                   class="w-full bg-gray-300 text-black p-2 rounded">
          </div>
          <!-- Wind speed 2 -->
          <div class="w-1/3">
            <label for="wind_speed2" class="block mb-1 text-sm font-medium text-gray-700">2:</label>
            <input type="number" id="wind_speed2" name="wind_speed2" min="0" required
                   class="w-full bg-gray-300 text-black p-2 rounded">
          </div>
          <!-- Wind speed 3 -->
          <div class="w-1/3">
            <label for="wind_speed3" class="block mb-1 text-sm font-medium text-gray-700">3:</label>
            <input type="number" id="wind_speed3" name="wind_speed3" min="0" required
                   class="w-full bg-gray-300 text-black p-2 rounded">
          </div>
        </div>

        <!-- Comments -->
        <div class="mb-6">
          <label for="comments" class="block mb-1 text-sm font-medium text-gray-700">Comments:</label>
          <textarea id="comments" name="comments" rows="4"
                    class="w-full bg-gray-300 text-black p-2 rounded resize-none"></textarea>
        </div>

        <!-- SD Cards -->
        <h2 class="text-lg font-semibold text-gray-700 mb-4">Choose SD card:</h2>
        {% if sd_cards %}
          <div class="space-y-4 mb-6">
            {% for card in sd_cards %}
              <label class="flex items-center space-x-2">
                <input type="radio" name="sd_card" value="{{ card }}" required
                       class="form-radio h-4 w-4 text-indigo-600"/>
                <div class="bg-indigo-300 text-black px-4 py-2 rounded w-full">
                  {{ card }}
                </div>
              </label>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-gray-700 font-medium mb-6">
            ðŸš« No SD cards with a <code>DCIM</code> folder were found.
          </p>
        {% endif %}

        <!-- Upload Button -->
        <div class="flex justify-center">
          <button id="upload-btn" type="submit"
                  class="px-6 py-2 rounded font-semibold 
                         {% if not sd_cards %}
                           bg-green-100 text-gray-400 cursor-not-allowed
                         {% else %}
                           bg-green-200 text-black hover:bg-green-300
                         {% endif %}"
                  {% if not sd_cards %}disabled{% endif %}>
            UPLOAD
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  document.getElementById('sd-form').addEventListener('submit', function() {
    // show overlay
    document.getElementById('loading-overlay').classList.remove('hidden');
    // disable button to prevent double-submit
    document.getElementById('upload-btn').disabled = true;
  });
</script>
{% endblock %}
