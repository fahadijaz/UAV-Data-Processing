{% extends "mainapp/base.html" %}
{% block title %}Review Drone Flights{% endblock %}
{% block content %}

<h2 class="text-2xl font-semibold mb-4">Review Drone Flights</h2>

<form action="{% url 'review_drone_flights' %}" method="get">
  <label for="field">Field:</label>
  <select id="field" name="field">
    {% for field in fields %}
      <option value="{{ field.value }}" {% if field.value == selected_field %}selected{% endif %}>{{ field.label }}</option>
    {% endfor %}
  </select>
  <br /><br />

  <label for="flight_type">Flight Type:</label>
  <select id="flight_type" name="flight_type">
    {% for ft in flight_types %}
      <option value="{{ ft.value }}" {% if ft.value == selected_flight_type %}selected{% endif %}>{{ ft.label }}</option>
    {% endfor %}
  </select>
  <br /><br />

  <label for="drone_pilot">Drone Pilot:</label>
  <select id="drone_pilot" name="drone_pilot">
    {% for pilot in drone_pilots %}
      <option value="{{ pilot.value }}" {% if pilot.value == selected_drone_pilot %}selected{% endif %}>{{ pilot.label }}</option>
    {% endfor %}
  </select>
  <br /><br />

  <label for="date_from">Date From:</label>
  <input type="date" id="date_from" name="date_from" value="{{ selected_date_from }}">
  <br /><br />

  <label for="date_to">Date To:</label>
  <input type="date" id="date_to" name="date_to" value="{{ selected_date_to }}">
  <br /><br />

  <script>
    const today = new Date().toISOString().split("T")[0];
    if (!document.getElementById("date_to").value) {
      document.getElementById("date_to").value = today;
    }

    document.querySelector("form").addEventListener("submit", function (e) {
      e.preventDefault();
      this.submit();
    });
  </script>

  <input type="submit" value="Submit" />
</form>

<br /><br />

<style>
  table, th, td {
    border: 1px solid black;
    border-collapse: collapse;
    padding: 8px;
  }

  tr.clickable-row {
    cursor: pointer;
  }

  tr.clickable-row:hover {
    background-color: #f0f0f0;
  }
</style>

<table style="width: 100%">
  <tr>
    <th>Field</th>
    <th>Date</th>
    <th>Image Type</th>
    <th>Drone Pilot</th>
    <th>Processing Status</th>
    <th>Coordinates Correct?</th>
  </tr>
  {% for flight in flights %}
    <tr class="clickable-row" data-href="{% url 'flight_detail' flight.id %}">
      <td>{{ flight.field }}</td>
      <td>{{ flight.date_display }}</td>
      <td>{{ flight.image_type }}</td>
      <td>{{ flight.drone_pilot }}</td>
      <td>{{ flight.processing_status }}</td>
      <td>{{ flight.coordinates_correct }}</td>
    </tr>
  {% empty %}
    <tr><td colspan="6">No flights found.</td></tr>
  {% endfor %}
</table>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const rows = document.querySelectorAll("tr.clickable-row");
    rows.forEach(row => {
      row.addEventListener("click", () => {
        window.location.href = row.dataset.href;
      });
    });
  });
</script>

{% endblock %}
