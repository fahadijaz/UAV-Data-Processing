{% extends "mainapp/base.html" %}
{% block title %}Review Drone Flights{% endblock %}
{% block content %}
<div class="p-6 bg-gray-50 min-h-screen">
  <h2 class="text-2xl font-bold mb-6 text-gray-800">Review Drone Flights</h2>
  
  <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
    <form action="{% url 'review_drone_flights' %}" method="get" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <div>
          <label for="field" class="block text-sm font-medium text-gray-700 mb-1">Field:</label>
          <select id="field" name="field" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            {% for field in fields %}
              <option value="{{ field.value }}" {% if field.value == selected_field %}selected{% endif %}>{{ field.label }}</option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label for="flight_type" class="block text-sm font-medium text-gray-700 mb-1">Flight Type:</label>
          <select id="flight_type" name="flight_type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            {% for ft in flight_types %}
              <option value="{{ ft.value }}" {% if ft.value == selected_flight_type %}selected{% endif %}>{{ ft.label }}</option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label for="drone_pilot" class="block text-sm font-medium text-gray-700 mb-1">Drone Pilot:</label>
          <select id="drone_pilot" name="drone_pilot" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            {% for pilot in drone_pilots %}
              <option value="{{ pilot.value }}" {% if pilot.value == selected_drone_pilot %}selected{% endif %}>{{ pilot.label }}</option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label for="date_from" class="block text-sm font-medium text-gray-700 mb-1">Date From:</label>
          <input type="date" id="date_from" name="date_from" value="{{ selected_date_from }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>

        <div>
          <label for="date_to" class="block text-sm font-medium text-gray-700 mb-1">Date To:</label>
          <input type="date" id="date_to" name="date_to" value="{{ selected_date_to }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
      </div>

      <div class="pt-4">
        <input type="submit" value="Submit" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-md shadow-sm transition-colors duration-200 cursor-pointer" />
      </div>
    </form>
  </div>

  <div class="bg-white rounded-lg shadow-lg overflow-hidden">
    <table class="w-full">
      <thead>
        <tr class="bg-gray-600 text-white">
          <th class="px-6 py-4 text-left font-semibold border-r border-gray-500">Field</th>
          <th class="px-6 py-4 text-left font-semibold border-r border-gray-500">Date</th>
          <th class="px-6 py-4 text-left font-semibold border-r border-gray-500">Image Type</th>
          <th class="px-6 py-4 text-left font-semibold border-r border-gray-500">Drone Pilot</th>
          <th class="px-6 py-4 text-left font-semibold border-r border-gray-500">Processing Status</th>
          <th class="px-6 py-4 text-left font-semibold">Coordinates Correct?</th>
        </tr>
      </thead>
      <tbody>
        {% for flight in flights %}
          <tr class="{% cycle 'bg-white' 'bg-gray-50' %} border-b border-gray-200 hover:bg-blue-50 transition-colors duration-150 cursor-pointer" data-href="{% url 'flight_detail' flight.id %}">
            <td class="px-6 py-4 font-medium text-gray-900 border-r border-gray-200">{{ flight.field }}</td>
            <td class="px-6 py-4 text-gray-700 border-r border-gray-200">{{ flight.date_display }}</td>
            <td class="px-6 py-4 text-gray-700 border-r border-gray-200">{{ flight.image_type }}</td>
            <td class="px-6 py-4 text-gray-700 border-r border-gray-200">{{ flight.drone_pilot }}</td>
            <td class="px-6 py-4 text-gray-700 border-r border-gray-200">{{ flight.processing_status }}</td>
            <td class="px-6 py-4 text-gray-700">{{ flight.coordinates_correct }}</td>
          </tr>
        {% empty %}
          <tr class="bg-white border-b border-gray-200">
            <td colspan="6" class="px-6 py-8 text-center text-gray-500 italic">No flights found.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
  const today = new Date().toISOString().split("T")[0];
  if (!document.getElementById("date_to").value) {
    document.getElementById("date_to").value = today;
  }
  document.querySelector("form").addEventListener("submit", function (e) {
    e.preventDefault();
    this.submit();
  });

  document.addEventListener("DOMContentLoaded", function () {
    const rows = document.querySelectorAll("tr[data-href]");
    rows.forEach(row => {
      row.addEventListener("click", () => {
        window.location.href = row.dataset.href;
      });
    });
  });
</script>
{% endblock %}
